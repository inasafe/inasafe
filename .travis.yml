language: python

python:
  - "2.7"

virtualenv:
  system_site_packages: true

branches:
  only:
    - master
    - develop

-before_install:
  - sudo apt-get -qq -y update
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x24"

install:
  - sudo apt-get install -y git qgis python-qgis pylint pep8 python-nose python-coverage pyflakes python-nosexcover python-scientific python-beautifulsoup
  - pip install -e . --use-mirrors
  - pip install flake8
  - echo "Checking out test data at" `date`
  - make testdata

before_script:
  - echo "Build starting on " `date`
  - export QGIS_PREFIX_PATH=/usr
  - export PYTHONPATH=${QGIS_PREFIX_PATH}/share/qgis/python/:${QGIS_PREFIX_PATH}/share/qgis/python/plugins:`pwd`
  - echo "PYTHONPATH:" $PYTHONPATH
  - ls ${QGIS_PREFIX_PATH}/share/qgis/python/plugins/
  - export LD_LIBRARY_PATH=${QGIS_PREFIX_PATH}/lib

script:
  - nosetests -v --with-id --with-xcoverage --with-xunit --verbose --cover-package=safe_qgis safe_qgis

notifications:
  irc:
    channels:
      - "irc.freenode.org#inasafe"
    use_notice: true

  email:
    - tim@kartoza.com
    - akbargumbira@gmail.com
